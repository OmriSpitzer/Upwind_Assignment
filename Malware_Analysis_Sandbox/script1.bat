@echo off
setlocal EnableExtensions EnableDelayedExpansion

echo ==========================================================
echo Malware Analysis Sandbox - demo script (safe folder churn)
echo ==========================================================
echo.
echo [info] This script will create and delete folders under:
echo        "%~dp0sandbox_temp"
echo.
echo [info] Start time: %date% %time%
echo.

set "ROOT=%~dp0sandbox_temp"
set "A=%ROOT%\drop_zone"
set "B=%ROOT%\logs"
set "C=%ROOT%\cache"
set "D=%ROOT%\cache\subcache"
set "E=%ROOT%\artifacts"

echo [step] Ensuring root exists
echo   - mkdir "%ROOT%"
if not exist "%ROOT%" mkdir "%ROOT%"
echo.

echo [step] Small change #1: create folders
echo   - mkdir "%A%"
echo   - mkdir "%B%"
echo   - mkdir "%C%"
echo   - mkdir "%D%"
echo   - mkdir "%E%"
if not exist "%A%" mkdir "%A%"
if not exist "%B%" mkdir "%B%"
if not exist "%C%" mkdir "%C%"
if not exist "%D%" mkdir "%D%"
if not exist "%E%" mkdir "%E%"
echo.

echo [step] Writing a couple of tiny files (then we will delete folders again)
echo demo log line 1 > "%B%\run.log"
echo demo log line 2 >> "%B%\run.log"
echo created at %date% %time% > "%E%\meta.txt"
echo.

echo [step] Listing what we created
echo   - dir "%ROOT%"
dir /b "%ROOT%"
echo.

echo [step] Small change #2: delete the same folders (cleanup pass #1)
echo   - rmdir /s /q "%A%"
echo   - rmdir /s /q "%B%"
echo   - rmdir /s /q "%C%"
echo   - rmdir /s /q "%E%"
if exist "%A%" rmdir /s /q "%A%"
if exist "%B%" rmdir /s /q "%B%"
if exist "%C%" rmdir /s /q "%C%"
if exist "%E%" rmdir /s /q "%E%"
echo.

echo [step] Re-create them again (small change #3)
for %%F in ("%A%" "%B%" "%C%" "%D%" "%E%") do (
  echo   - mkdir "%%~F"
  if not exist "%%~F" mkdir "%%~F"
)
echo.

echo [step] Add more noisy output (simulate work)
for /L %%I in (1,1,12) do (
  echo [work] Iteration %%I/12
  echo iteration=%%I time=%time%>> "%B%\run.log"
)
echo.

echo [step] Cleanup again (small change #4: delete same folders)
for %%F in ("%A%" "%B%" "%C%" "%E%") do (
  echo   - rmdir /s /q "%%~F"
  if exist "%%~F" rmdir /s /q "%%~F"
)

echo.
echo [step] Optional: remove root if empty
echo   - rmdir "%ROOT%"
2>nul rmdir "%ROOT%"

echo.
echo [done] End time: %date% %time%
echo [done] If you want the folders to remain, comment out the cleanup sections.
echo.
endlocal
exit /b 0